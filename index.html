<!-- ===== CHATBOX n8n (KAI Silpro3R) ===== -->
<div class="card" style="padding:16px; margin-top:14px;">
  <h3 style="margin:0 0 10px 0;">Chat de captura (n8n)</h3>

  <div id="kai-chat" style="border:1px solid var(--line);border-radius:14px;overflow:hidden;background:rgba(255,255,255,.04);">
    <div id="kai-log" style="height:320px;overflow:auto;padding:12px;background:rgba(0,0,0,.12);"></div>

    <form id="kai-form" style="display:flex;gap:8px;padding:12px;border-top:1px solid var(--line);background:rgba(255,255,255,.02);">
      <input id="kai-msg" placeholder="Escribe aqu√≠‚Ä¶" autocomplete="off"
             style="flex:1;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:rgba(255,255,255,.04);" />
      <button class="btn primary" type="submit">Enviar</button>
    </form>
  </div>
</div>

<script>
  // ‚ö†Ô∏è Pon aqu√≠ tu Production URL REAL:
  const WEBHOOK_URL = "https://TU-N8N-DOMINIO/webhook/kai-chat";

  const log = document.getElementById("kai-log");
  const form = document.getElementById("kai-form");
  const input = document.getElementById("kai-msg");

  const sessionId = localStorage.getItem("kai_sessionId") || (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()));
  localStorage.setItem("kai_sessionId", sessionId);

  function add(role, text) {
    const row = document.createElement("div");
    row.style.margin = "8px 0";
    row.innerHTML = `<b>${role}:</b> ${text}`;
    log.appendChild(row);
    log.scrollTop = log.scrollHeight;
  }

  add("Bot", "Hola üëã Soy el chat conectado a n8n. Escribe un mensaje para probar.");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const message = input.value.trim();
    if (!message) return;

    input.value = "";
    add("T√∫", message);

    try {
      const r = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message, sessionId })
      });

      if (!r.ok) throw new Error("HTTP " + r.status);
      const data = await r.json();
      add("Bot", data.reply ?? "(sin respuesta)");
    } catch (err) {
      console.error(err);
      add("Bot", "‚ùå Error conectando con n8n. Revisa URL / workflow activo / CORS.");
    }
  });
</script>
<!-- ===== /CHATBOX n8n ===== -->
